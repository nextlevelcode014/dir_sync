<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dir Sync: src/utils.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Dir Sync<span id="projectnumber">&#160;1</span>
   </div>
   <div id="projectbrief">Sync your backups easier</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('utils_8c.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">utils.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;dirent.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;limits.h&gt;</code><br />
<code>#include &quot;<a class="el" href="utils_8h_source.html">utils.h</a>&quot;</code><br />
<code>#include &lt;fnmatch.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for utils.c:</div>
<div class="dyncontent">
<div class="center"><img src="utils_8c__incl.png" border="0" usemap="#asrc_2utils_8c" loading="lazy" alt=""/></div>
<map name="asrc_2utils_8c" id="asrc_2utils_8c">
<area shape="rect" title=" " alt="" coords="400,5,478,31"/>
<area shape="rect" title=" " alt="" coords="5,79,65,105"/>
<area shape="poly" title=" " alt="" coords="400,27,263,48,80,81,79,76,262,42,399,22"/>
<area shape="rect" title=" " alt="" coords="89,79,152,105"/>
<area shape="poly" title=" " alt="" coords="401,30,167,81,166,76,399,25"/>
<area shape="rect" title=" " alt="" coords="175,79,239,105"/>
<area shape="poly" title=" " alt="" coords="401,34,254,79,253,74,399,29"/>
<area shape="rect" title=" " alt="" coords="263,79,330,105"/>
<area shape="poly" title=" " alt="" coords="416,34,336,74,333,69,414,29"/>
<area shape="rect" title=" " alt="" coords="354,79,431,105"/>
<area shape="poly" title=" " alt="" coords="434,33,411,67,406,64,429,30"/>
<area shape="rect" title=" " alt="" coords="455,79,519,105"/>
<area shape="poly" title=" " alt="" coords="449,30,473,64,468,67,445,33"/>
<area shape="rect" title=" " alt="" coords="543,79,599,105"/>
<area shape="poly" title=" " alt="" coords="463,29,537,69,534,74,460,34"/>
<area shape="rect" title=" " alt="" coords="624,79,686,105"/>
<area shape="poly" title=" " alt="" coords="476,29,610,73,608,78,475,34"/>
<area shape="rect" href="utils_8h.html" title=" " alt="" coords="710,79,765,105"/>
<area shape="poly" title=" " alt="" coords="479,25,696,76,694,81,478,30"/>
<area shape="rect" title=" " alt="" coords="789,79,868,105"/>
<area shape="poly" title=" " alt="" coords="479,23,774,76,773,81,478,28"/>
</map>
</div>
</div>
<p><a href="utils_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a53013572dd5eddea79ba70b96dd8fa47" id="r_a53013572dd5eddea79ba70b96dd8fa47"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a53013572dd5eddea79ba70b96dd8fa47">copy_file</a> (const char *src_path, const char *dst_path)</td></tr>
<tr class="memdesc:a53013572dd5eddea79ba70b96dd8fa47"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies a file from source path to the destination path.  <br /></td></tr>
<tr class="memitem:af09b83ee30375f727266fd1fc540404e" id="r_af09b83ee30375f727266fd1fc540404e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af09b83ee30375f727266fd1fc540404e">log_event</a> (const char *message, const char *src, const char *dst)</td></tr>
<tr class="memdesc:af09b83ee30375f727266fd1fc540404e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Logs an event indicating a change between source and destination files.  <br /></td></tr>
<tr class="memitem:aab5e3cbbe46659075de35f7a5d425ca4" id="r_aab5e3cbbe46659075de35f7a5d425ca4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aab5e3cbbe46659075de35f7a5d425ca4">mkdir_p</a> (const char *path)</td></tr>
<tr class="memitem:a3fdcd826e504728b17a526e3796c0aa9" id="r_a3fdcd826e504728b17a526e3796c0aa9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3fdcd826e504728b17a526e3796c0aa9">sync_directories</a> (const char *src, const char *dst)</td></tr>
<tr class="memdesc:a3fdcd826e504728b17a526e3796c0aa9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Recursively synchronizes two directories.  <br /></td></tr>
<tr class="memitem:adea68d9f366b7b0090fa791745b22d2b" id="r_adea68d9f366b7b0090fa791745b22d2b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adea68d9f366b7b0090fa791745b22d2b">blacklist</a> (const char *black_dir)</td></tr>
<tr class="memdesc:adea68d9f366b7b0090fa791745b22d2b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether a file or directory is blacklisted.  <br /></td></tr>
<tr class="memitem:a231659ba0555e0d2d3db08f29c62cfaf" id="r_a231659ba0555e0d2d3db08f29c62cfaf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a231659ba0555e0d2d3db08f29c62cfaf">is_temporary_file</a> (const char *filename)</td></tr>
<tr class="memdesc:a231659ba0555e0d2d3db08f29c62cfaf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks whether a file is considered temporary.  <br /></td></tr>
</table>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="adea68d9f366b7b0090fa791745b22d2b" name="adea68d9f366b7b0090fa791745b22d2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adea68d9f366b7b0090fa791745b22d2b">&#9670;&#160;</a></span>blacklist()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int blacklist </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>black_dir</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check whether a file or directory is blacklisted. </p>
<p>Reads the blacklist file from the path defined in the <span class="tt">BLACKLIST_PATH</span> environment variable and compares the entry.</p>
<dl class="section return"><dt>Returns</dt><dd>1 if blacklisted, 0 otherwise. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">black_dir</td><td>Directory/file to be skipped </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="utils_8c_source.html#l00099">99</a> of file <a class="el" href="utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  100</span>{</div>
<div class="line"><span class="lineno">  101</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *path = getenv(<span class="stringliteral">&quot;BLACKLIST_PATH&quot;</span>);</div>
<div class="line"><span class="lineno">  102</span>    <span class="keywordflow">if</span> (!path)</div>
<div class="line"><span class="lineno">  103</span>    {</div>
<div class="line"><span class="lineno">  104</span>        fprintf(stdout, <span class="stringliteral">&quot;blcklist not set&quot;</span>);</div>
<div class="line"><span class="lineno">  105</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  106</span>    }</div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  108</span>    FILE *file = fopen(path, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><span class="lineno">  109</span>    <span class="keywordflow">if</span> (!file)</div>
<div class="line"><span class="lineno">  110</span>    {</div>
<div class="line"><span class="lineno">  111</span>        perror(<span class="stringliteral">&quot;Cannot open blacklist file&quot;</span>);</div>
<div class="line"><span class="lineno">  112</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  113</span>    }</div>
<div class="line"><span class="lineno">  114</span> </div>
<div class="line"><span class="lineno">  115</span>    <span class="keywordtype">char</span> line[<a class="code hl_define" href="utils_8h.html#a842ed03f27719bc87666bfd1f75415b8">MAX_LINE</a>];</div>
<div class="line"><span class="lineno">  116</span>    <span class="keywordflow">while</span> (fgets(line, <span class="keyword">sizeof</span>(line), file))</div>
<div class="line"><span class="lineno">  117</span>    {</div>
<div class="line"><span class="lineno">  118</span>        line[strcspn(line, <span class="stringliteral">&quot;\r\n&quot;</span>)] = 0;</div>
<div class="line"><span class="lineno">  119</span> </div>
<div class="line"><span class="lineno">  120</span>        <span class="keywordflow">if</span> (strcmp(black_dir, line) == 0)</div>
<div class="line"><span class="lineno">  121</span>        {</div>
<div class="line"><span class="lineno">  122</span>            fprintf(stdout, <span class="stringliteral">&quot;[blacklist] Skipping blacklisted path: %s\n&quot;</span>, black_dir);</div>
<div class="line"><span class="lineno">  123</span>            fclose(file);</div>
<div class="line"><span class="lineno">  124</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  125</span>        }</div>
<div class="line"><span class="lineno">  126</span>    }</div>
<div class="line"><span class="lineno">  127</span> </div>
<div class="line"><span class="lineno">  128</span>    fclose(file);</div>
<div class="line"><span class="lineno">  129</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  130</span>}</div>
<div class="ttc" id="autils_8h_html_a842ed03f27719bc87666bfd1f75415b8"><div class="ttname"><a href="utils_8h.html#a842ed03f27719bc87666bfd1f75415b8">MAX_LINE</a></div><div class="ttdeci">#define MAX_LINE</div><div class="ttdef"><b>Definition</b> <a href="utils_8h_source.html#l00004">utils.h:4</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="utils_8c_adea68d9f366b7b0090fa791745b22d2b_icgraph.png" border="0" usemap="#autils_8c_adea68d9f366b7b0090fa791745b22d2b_icgraph" loading="lazy" alt=""/></div>
<map name="autils_8c_adea68d9f366b7b0090fa791745b22d2b_icgraph" id="autils_8c_adea68d9f366b7b0090fa791745b22d2b_icgraph">
<area shape="rect" title="Check whether a file or directory is blacklisted." alt="" coords="295,80,364,106"/>
<area shape="rect" href="watcher_8c.html#a3f26d51aef64a440d0646f9a3b47386c" title="Recursively adds a directory and all its subdirectories to the watch list." alt="" coords="103,29,247,55"/>
<area shape="poly" title=" " alt="" coords="279,79,215,58,217,53,281,74"/>
<area shape="rect" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="Main program entry point." alt="" coords="5,80,55,106"/>
<area shape="poly" title=" " alt="" coords="280,96,55,96,55,90,280,90"/>
<area shape="rect" href="utils_8c.html#a3fdcd826e504728b17a526e3796c0aa9" title="Recursively synchronizes two directories." alt="" coords="117,155,232,180"/>
<area shape="poly" title=" " alt="" coords="289,115,205,156,202,152,286,110"/>
<area shape="poly" title=" " alt="" coords="199,16,191,10,175,8,160,10,152,14,150,20,155,28,150,30,145,21,148,11,158,5,175,3,193,5,202,12"/>
<area shape="poly" title=" " alt="" coords="122,63,56,87,54,82,120,58"/>
<area shape="poly" title=" " alt="" coords="134,150,54,108,56,103,136,145"/>
<area shape="poly" title=" " alt="" coords="199,142,191,136,175,133,160,135,152,140,150,146,155,153,150,156,145,146,148,137,158,130,175,128,193,131,202,137"/>
</map>
</div>

</div>
</div>
<a id="a53013572dd5eddea79ba70b96dd8fa47" name="a53013572dd5eddea79ba70b96dd8fa47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53013572dd5eddea79ba70b96dd8fa47">&#9670;&#160;</a></span>copy_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void copy_file </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>src_path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>dst_path</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies a file from source path to the destination path. </p>
<p>Opens the source file for reading and writes its contents to the destination file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">src_path</td><td>Path to the source file. </td></tr>
    <tr><td class="paramname">dst_path</td><td>Path to the destination file. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="utils_8c_source.html#l00012">12</a> of file <a class="el" href="utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   13</span>{</div>
<div class="line"><span class="lineno">   14</span>    FILE *src = fopen(src_path, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><span class="lineno">   15</span>    FILE *dst = fopen(dst_path, <span class="stringliteral">&quot;wb&quot;</span>);</div>
<div class="line"><span class="lineno">   16</span> </div>
<div class="line"><span class="lineno">   17</span>    <span class="keywordflow">if</span> (!src || !dst)</div>
<div class="line"><span class="lineno">   18</span>    {</div>
<div class="line"><span class="lineno">   19</span>        perror(<span class="stringliteral">&quot;copy_file fopen&quot;</span>);</div>
<div class="line"><span class="lineno">   20</span>        <span class="keywordflow">if</span> (src)</div>
<div class="line"><span class="lineno">   21</span>            fclose(src);</div>
<div class="line"><span class="lineno">   22</span>        <span class="keywordflow">if</span> (dst)</div>
<div class="line"><span class="lineno">   23</span>            fclose(dst);</div>
<div class="line"><span class="lineno">   24</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   25</span>    }</div>
<div class="line"><span class="lineno">   26</span> </div>
<div class="line"><span class="lineno">   27</span>    <span class="keywordtype">char</span> buf[4096];</div>
<div class="line"><span class="lineno">   28</span>    <span class="keywordtype">size_t</span> size;</div>
<div class="line"><span class="lineno">   29</span>    <span class="keywordflow">while</span> ((size = fread(buf, 1, <span class="keyword">sizeof</span>(buf), src)) &gt; 0)</div>
<div class="line"><span class="lineno">   30</span>    {</div>
<div class="line"><span class="lineno">   31</span>        fwrite(buf, 1, size, dst);</div>
<div class="line"><span class="lineno">   32</span>    }</div>
<div class="line"><span class="lineno">   33</span> </div>
<div class="line"><span class="lineno">   34</span>    fclose(src);</div>
<div class="line"><span class="lineno">   35</span>    fclose(dst);</div>
<div class="line"><span class="lineno">   36</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="utils_8c_a53013572dd5eddea79ba70b96dd8fa47_icgraph.png" border="0" usemap="#autils_8c_a53013572dd5eddea79ba70b96dd8fa47_icgraph" loading="lazy" alt=""/></div>
<map name="autils_8c_a53013572dd5eddea79ba70b96dd8fa47_icgraph" id="autils_8c_a53013572dd5eddea79ba70b96dd8fa47_icgraph">
<area shape="rect" title="Copies a file from source path to the destination path." alt="" coords="266,8,337,33"/>
<area shape="rect" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="Main program entry point." alt="" coords="5,8,55,33"/>
<area shape="poly" title=" " alt="" coords="250,15,218,11,160,8,103,11,55,18,55,13,102,6,160,3,218,6,251,9"/>
<area shape="rect" href="utils_8c.html#a3fdcd826e504728b17a526e3796c0aa9" title="Recursively synchronizes two directories." alt="" coords="103,45,218,71"/>
<area shape="poly" title=" " alt="" coords="252,36,212,47,211,42,250,31"/>
<area shape="poly" title=" " alt="" coords="98,43,54,30,56,25,99,37"/>
<area shape="poly" title=" " alt="" coords="182,32,174,26,160,24,147,25,140,30,139,36,142,43,138,46,133,36,136,27,145,20,160,18,177,21,185,28"/>
</map>
</div>

</div>
</div>
<a id="a231659ba0555e0d2d3db08f29c62cfaf" name="a231659ba0555e0d2d3db08f29c62cfaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a231659ba0555e0d2d3db08f29c62cfaf">&#9670;&#160;</a></span>is_temporary_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int is_temporary_file </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>filename</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks whether a file is considered temporary. </p>
<p>Matches common temporary file patterns.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filename</td><td>Name of the file to check. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if the file is temporary, 0 otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="utils_8c_source.html#l00132">132</a> of file <a class="el" href="utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  133</span>{</div>
<div class="line"><span class="lineno">  134</span>    <span class="keywordflow">return</span> (</div>
<div class="line"><span class="lineno">  135</span>        strcmp(filename, <span class="stringliteral">&quot;4913&quot;</span>) == 0 ||</div>
<div class="line"><span class="lineno">  136</span>        fnmatch(<span class="stringliteral">&quot;*.swp&quot;</span>, filename, 0) == 0 ||</div>
<div class="line"><span class="lineno">  137</span>        fnmatch(<span class="stringliteral">&quot;*.swo&quot;</span>, filename, 0) == 0 ||</div>
<div class="line"><span class="lineno">  138</span>        fnmatch(<span class="stringliteral">&quot;*.swn&quot;</span>, filename, 0) == 0 ||</div>
<div class="line"><span class="lineno">  139</span>        fnmatch(<span class="stringliteral">&quot;.*.sw?&quot;</span>, filename, 0) == 0 ||</div>
<div class="line"><span class="lineno">  140</span> </div>
<div class="line"><span class="lineno">  141</span>        fnmatch(<span class="stringliteral">&quot;#*#&quot;</span>, filename, 0) == 0 ||</div>
<div class="line"><span class="lineno">  142</span>        fnmatch(<span class="stringliteral">&quot;.#*&quot;</span>, filename, 0) == 0 ||</div>
<div class="line"><span class="lineno">  143</span> </div>
<div class="line"><span class="lineno">  144</span>        fnmatch(<span class="stringliteral">&quot;*~&quot;</span>, filename, 0) == 0 ||</div>
<div class="line"><span class="lineno">  145</span>        fnmatch(<span class="stringliteral">&quot;*.bak&quot;</span>, filename, 0) == 0 ||</div>
<div class="line"><span class="lineno">  146</span>        fnmatch(<span class="stringliteral">&quot;*.tmp&quot;</span>, filename, 0) == 0 ||</div>
<div class="line"><span class="lineno">  147</span> </div>
<div class="line"><span class="lineno">  148</span>        fnmatch(<span class="stringliteral">&quot;*.code-workspace.temp&quot;</span>, filename, 0) == 0 ||</div>
<div class="line"><span class="lineno">  149</span>        fnmatch(<span class="stringliteral">&quot;.vscode&quot;</span>, filename, 0) == 0 ||</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span>        fnmatch(<span class="stringliteral">&quot;.~lock.*#&quot;</span>, filename, 0) == 0);</div>
<div class="line"><span class="lineno">  152</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="utils_8c_a231659ba0555e0d2d3db08f29c62cfaf_icgraph.png" border="0" usemap="#autils_8c_a231659ba0555e0d2d3db08f29c62cfaf_icgraph" loading="lazy" alt=""/></div>
<map name="autils_8c_a231659ba0555e0d2d3db08f29c62cfaf_icgraph" id="autils_8c_a231659ba0555e0d2d3db08f29c62cfaf_icgraph">
<area shape="rect" title="Checks whether a file is considered temporary." alt="" coords="295,80,413,106"/>
<area shape="rect" href="watcher_8c.html#a3f26d51aef64a440d0646f9a3b47386c" title="Recursively adds a directory and all its subdirectories to the watch list." alt="" coords="103,29,247,55"/>
<area shape="poly" title=" " alt="" coords="291,78,222,58,223,53,292,73"/>
<area shape="rect" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="Main program entry point." alt="" coords="5,80,55,106"/>
<area shape="poly" title=" " alt="" coords="279,96,55,96,55,90,279,90"/>
<area shape="rect" href="utils_8c.html#a3fdcd826e504728b17a526e3796c0aa9" title="Recursively synchronizes two directories." alt="" coords="117,155,232,180"/>
<area shape="poly" title=" " alt="" coords="308,115,209,156,207,152,306,110"/>
<area shape="poly" title=" " alt="" coords="199,16,191,10,175,8,160,10,152,14,150,20,155,28,150,30,145,21,148,11,158,5,175,3,193,5,202,12"/>
<area shape="poly" title=" " alt="" coords="122,63,56,87,54,82,120,58"/>
<area shape="poly" title=" " alt="" coords="134,150,54,108,56,103,136,145"/>
<area shape="poly" title=" " alt="" coords="199,142,191,136,175,133,160,135,152,140,150,146,155,153,150,156,145,146,148,137,158,130,175,128,193,131,202,137"/>
</map>
</div>

</div>
</div>
<a id="af09b83ee30375f727266fd1fc540404e" name="af09b83ee30375f727266fd1fc540404e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af09b83ee30375f727266fd1fc540404e">&#9670;&#160;</a></span>log_event()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void log_event </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>message</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>src</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>dst</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Logs an event indicating a change between source and destination files. </p>
<p>Tipically used to track modifications during synchronization.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">message</td><td>Description of the event. </td></tr>
    <tr><td class="paramname">src</td><td>Path to the source file. </td></tr>
    <tr><td class="paramname">dst</td><td>Path to the destination file. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="utils_8c_source.html#l00038">38</a> of file <a class="el" href="utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   39</span>{</div>
<div class="line"><span class="lineno">   40</span>    time_t now = time(NULL);</div>
<div class="line"><span class="lineno">   41</span>    <span class="keyword">struct </span>tm *t = localtime(&amp;now);</div>
<div class="line"><span class="lineno">   42</span>    <span class="keywordtype">char</span> ts[32];</div>
<div class="line"><span class="lineno">   43</span>    strftime(ts, <span class="keyword">sizeof</span>(ts), <span class="stringliteral">&quot;[%Y-%m-%d %H:%M:%S]&quot;</span>, t);</div>
<div class="line"><span class="lineno">   44</span>    printf(<span class="stringliteral">&quot;%s %s: %s → %s\n&quot;</span>, ts, message, src, dst);</div>
<div class="line"><span class="lineno">   45</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="utils_8c_af09b83ee30375f727266fd1fc540404e_icgraph.png" border="0" usemap="#autils_8c_af09b83ee30375f727266fd1fc540404e_icgraph" loading="lazy" alt=""/></div>
<map name="autils_8c_af09b83ee30375f727266fd1fc540404e_icgraph" id="autils_8c_af09b83ee30375f727266fd1fc540404e_icgraph">
<area shape="rect" title="Logs an event indicating a change between source and destination files." alt="" coords="103,5,180,31"/>
<area shape="rect" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="Main program entry point." alt="" coords="5,5,55,31"/>
<area shape="poly" title=" " alt="" coords="87,21,55,21,55,16,87,16"/>
</map>
</div>

</div>
</div>
<a id="aab5e3cbbe46659075de35f7a5d425ca4" name="aab5e3cbbe46659075de35f7a5d425ca4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab5e3cbbe46659075de35f7a5d425ca4">&#9670;&#160;</a></span>mkdir_p()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mkdir_p </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="utils_8c_source.html#l00047">47</a> of file <a class="el" href="utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   48</span>{</div>
<div class="line"><span class="lineno">   49</span>    <span class="keywordtype">char</span> tmp[8192];</div>
<div class="line"><span class="lineno">   50</span>    snprintf(tmp, <span class="keyword">sizeof</span>(tmp), <span class="stringliteral">&quot;%s&quot;</span>, path);</div>
<div class="line"><span class="lineno">   51</span>    <span class="keywordflow">for</span> (<span class="keywordtype">char</span> *p = tmp + 1; *p; p++)</div>
<div class="line"><span class="lineno">   52</span>    {</div>
<div class="line"><span class="lineno">   53</span>        <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;/&#39;</span>)</div>
<div class="line"><span class="lineno">   54</span>        {</div>
<div class="line"><span class="lineno">   55</span>            *p = 0;</div>
<div class="line"><span class="lineno">   56</span>            mkdir(tmp, 0755);</div>
<div class="line"><span class="lineno">   57</span>            *p = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><span class="lineno">   58</span>        }</div>
<div class="line"><span class="lineno">   59</span>    }</div>
<div class="line"><span class="lineno">   60</span>    mkdir(tmp, 0755);</div>
<div class="line"><span class="lineno">   61</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="utils_8c_aab5e3cbbe46659075de35f7a5d425ca4_icgraph.png" border="0" usemap="#autils_8c_aab5e3cbbe46659075de35f7a5d425ca4_icgraph" loading="lazy" alt=""/></div>
<map name="autils_8c_aab5e3cbbe46659075de35f7a5d425ca4_icgraph" id="autils_8c_aab5e3cbbe46659075de35f7a5d425ca4_icgraph">
<area shape="rect" title=" " alt="" coords="266,8,333,33"/>
<area shape="rect" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="Main program entry point." alt="" coords="5,8,55,33"/>
<area shape="poly" title=" " alt="" coords="250,15,218,11,160,8,103,11,55,18,55,13,102,6,160,3,218,6,251,9"/>
<area shape="rect" href="utils_8c.html#a3fdcd826e504728b17a526e3796c0aa9" title="Recursively synchronizes two directories." alt="" coords="103,45,218,71"/>
<area shape="poly" title=" " alt="" coords="252,36,211,47,210,42,250,31"/>
<area shape="poly" title=" " alt="" coords="98,43,54,30,56,25,99,37"/>
<area shape="poly" title=" " alt="" coords="182,32,174,26,160,24,147,25,140,30,139,36,142,43,138,46,133,36,136,27,145,21,160,18,177,21,185,28"/>
</map>
</div>

</div>
</div>
<a id="a3fdcd826e504728b17a526e3796c0aa9" name="a3fdcd826e504728b17a526e3796c0aa9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fdcd826e504728b17a526e3796c0aa9">&#9670;&#160;</a></span>sync_directories()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sync_directories </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>src</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>dst</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Recursively synchronizes two directories. </p>
<p>All entries from the source directory are copied to the destination directory. If the destination does not exist, it is created. Temporary files, hidden files, and blacklisted entries (as defined in <span class="tt">BLACKLIST_PATH</span>) are skipped)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">src</td><td>Source directory (entries will be copied from here). </td></tr>
    <tr><td class="paramname">dst</td><td>Destination directory (entries will be copied to here). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="utils_8c_source.html#l00063">63</a> of file <a class="el" href="utils_8c_source.html">utils.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   64</span>{</div>
<div class="line"><span class="lineno">   65</span>    DIR *dir = opendir(src);</div>
<div class="line"><span class="lineno">   66</span>    <span class="keywordflow">if</span> (!dir)</div>
<div class="line"><span class="lineno">   67</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   68</span> </div>
<div class="line"><span class="lineno">   69</span>    <a class="code hl_function" href="#aab5e3cbbe46659075de35f7a5d425ca4">mkdir_p</a>(dst);</div>
<div class="line"><span class="lineno">   70</span>    <span class="keyword">struct </span>dirent *entry;</div>
<div class="line"><span class="lineno">   71</span>    <span class="keywordflow">while</span> ((entry = readdir(dir)))</div>
<div class="line"><span class="lineno">   72</span>    {</div>
<div class="line"><span class="lineno">   73</span>        <span class="keywordflow">if</span> (strcmp(entry-&gt;d_name, <span class="stringliteral">&quot;.&quot;</span>) == 0 || strcmp(entry-&gt;d_name, <span class="stringliteral">&quot;..&quot;</span>) == 0 || <a class="code hl_function" href="#adea68d9f366b7b0090fa791745b22d2b">blacklist</a>(entry-&gt;d_name) || <a class="code hl_function" href="#a231659ba0555e0d2d3db08f29c62cfaf">is_temporary_file</a>(entry-&gt;d_name))</div>
<div class="line"><span class="lineno">   74</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">   75</span> </div>
<div class="line"><span class="lineno">   76</span>        <span class="keywordtype">char</span> src_path[PATH_MAX], dst_path[PATH_MAX];</div>
<div class="line"><span class="lineno">   77</span> </div>
<div class="line"><span class="lineno">   78</span>        snprintf(src_path, <span class="keyword">sizeof</span>(src_path), <span class="stringliteral">&quot;%s/%s&quot;</span>, src, entry-&gt;d_name);</div>
<div class="line"><span class="lineno">   79</span>        snprintf(dst_path, <span class="keyword">sizeof</span>(dst_path), <span class="stringliteral">&quot;%s/%s&quot;</span>, dst, entry-&gt;d_name);</div>
<div class="line"><span class="lineno">   80</span> </div>
<div class="line"><span class="lineno">   81</span>        <span class="keyword">struct </span>stat st;</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>        <span class="keywordflow">if</span> (stat(src_path, &amp;st) &lt; 0)</div>
<div class="line"><span class="lineno">   84</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">   85</span> </div>
<div class="line"><span class="lineno">   86</span>        <span class="keywordflow">if</span> (S_ISDIR(st.st_mode))</div>
<div class="line"><span class="lineno">   87</span>        {</div>
<div class="line"><span class="lineno">   88</span>            <a class="code hl_function" href="#a3fdcd826e504728b17a526e3796c0aa9">sync_directories</a>(src_path, dst_path);</div>
<div class="line"><span class="lineno">   89</span>        }</div>
<div class="line"><span class="lineno">   90</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (S_ISREG(st.st_mode))</div>
<div class="line"><span class="lineno">   91</span>        {</div>
<div class="line"><span class="lineno">   92</span>            <a class="code hl_function" href="#a53013572dd5eddea79ba70b96dd8fa47">copy_file</a>(src_path, dst_path);</div>
<div class="line"><span class="lineno">   93</span>        }</div>
<div class="line"><span class="lineno">   94</span>    }</div>
<div class="line"><span class="lineno">   95</span> </div>
<div class="line"><span class="lineno">   96</span>    closedir(dir);</div>
<div class="line"><span class="lineno">   97</span>}</div>
<div class="ttc" id="autils_8c_html_a231659ba0555e0d2d3db08f29c62cfaf"><div class="ttname"><a href="#a231659ba0555e0d2d3db08f29c62cfaf">is_temporary_file</a></div><div class="ttdeci">int is_temporary_file(const char *filename)</div><div class="ttdoc">Checks whether a file is considered temporary.</div><div class="ttdef"><b>Definition</b> <a href="utils_8c_source.html#l00132">utils.c:132</a></div></div>
<div class="ttc" id="autils_8c_html_a3fdcd826e504728b17a526e3796c0aa9"><div class="ttname"><a href="#a3fdcd826e504728b17a526e3796c0aa9">sync_directories</a></div><div class="ttdeci">void sync_directories(const char *src, const char *dst)</div><div class="ttdoc">Recursively synchronizes two directories.</div><div class="ttdef"><b>Definition</b> <a href="utils_8c_source.html#l00063">utils.c:63</a></div></div>
<div class="ttc" id="autils_8c_html_a53013572dd5eddea79ba70b96dd8fa47"><div class="ttname"><a href="#a53013572dd5eddea79ba70b96dd8fa47">copy_file</a></div><div class="ttdeci">void copy_file(const char *src_path, const char *dst_path)</div><div class="ttdoc">Copies a file from source path to the destination path.</div><div class="ttdef"><b>Definition</b> <a href="utils_8c_source.html#l00012">utils.c:12</a></div></div>
<div class="ttc" id="autils_8c_html_aab5e3cbbe46659075de35f7a5d425ca4"><div class="ttname"><a href="#aab5e3cbbe46659075de35f7a5d425ca4">mkdir_p</a></div><div class="ttdeci">void mkdir_p(const char *path)</div><div class="ttdef"><b>Definition</b> <a href="utils_8c_source.html#l00047">utils.c:47</a></div></div>
<div class="ttc" id="autils_8c_html_adea68d9f366b7b0090fa791745b22d2b"><div class="ttname"><a href="#adea68d9f366b7b0090fa791745b22d2b">blacklist</a></div><div class="ttdeci">int blacklist(const char *black_dir)</div><div class="ttdoc">Check whether a file or directory is blacklisted.</div><div class="ttdef"><b>Definition</b> <a href="utils_8c_source.html#l00099">utils.c:99</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="utils_8c_a3fdcd826e504728b17a526e3796c0aa9_cgraph.png" border="0" usemap="#autils_8c_a3fdcd826e504728b17a526e3796c0aa9_cgraph" loading="lazy" alt=""/></div>
<map name="autils_8c_a3fdcd826e504728b17a526e3796c0aa9_cgraph" id="autils_8c_a3fdcd826e504728b17a526e3796c0aa9_cgraph">
<area shape="rect" title="Recursively synchronizes two directories." alt="" coords="5,80,121,106"/>
<area shape="poly" title=" " alt="" coords="35,81,30,71,33,62,44,56,63,53,83,56,94,63,91,67,81,61,63,59,46,61,37,65,35,71,39,78"/>
<area shape="rect" href="utils_8c.html#adea68d9f366b7b0090fa791745b22d2b" title="Check whether a file or directory is blacklisted." alt="" coords="193,5,262,31"/>
<area shape="poly" title=" " alt="" coords="90,77,168,40,178,35,180,40,170,45,92,82"/>
<area shape="rect" href="utils_8c.html#a53013572dd5eddea79ba70b96dd8fa47" title="Copies a file from source path to the destination path." alt="" coords="192,55,264,80"/>
<area shape="poly" title=" " alt="" coords="121,81,177,73,177,78,121,87"/>
<area shape="rect" href="utils_8c.html#a231659ba0555e0d2d3db08f29c62cfaf" title="Checks whether a file is considered temporary." alt="" coords="169,104,287,130"/>
<area shape="poly" title=" " alt="" coords="121,99,154,103,153,109,121,104"/>
<area shape="rect" href="utils_8c.html#aab5e3cbbe46659075de35f7a5d425ca4" title=" " alt="" coords="194,153,262,179"/>
<area shape="poly" title=" " alt="" coords="93,104,170,140,181,145,179,150,168,145,90,109"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="utils_8c_a3fdcd826e504728b17a526e3796c0aa9_icgraph.png" border="0" usemap="#autils_8c_a3fdcd826e504728b17a526e3796c0aa9_icgraph" loading="lazy" alt=""/></div>
<map name="autils_8c_a3fdcd826e504728b17a526e3796c0aa9_icgraph" id="autils_8c_a3fdcd826e504728b17a526e3796c0aa9_icgraph">
<area shape="rect" title="Recursively synchronizes two directories." alt="" coords="103,29,218,55"/>
<area shape="poly" title=" " alt="" coords="182,16,174,10,160,8,147,10,140,14,139,20,142,28,138,30,133,21,136,11,145,5,160,3,177,5,185,12"/>
<area shape="rect" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="Main program entry point." alt="" coords="5,29,55,55"/>
<area shape="poly" title=" " alt="" coords="87,45,55,45,55,40,87,40"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="utils_8c.html">utils.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
